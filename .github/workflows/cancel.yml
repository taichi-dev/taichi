name: Cancel
on:
  workflow_run:
    workflows: ["Build and Test"]
    branches-ignore: [master]
    types:
      - requested

jobs:
  cancel:
    runs-on: ubuntu-latest
    steps:
      - run: |
          RUN_ID=$(gh run list -w "Build and Test"|awk -F '\t' '{if ($6 == "pull_request") {print;exit}}'|awk -F '\t' '{print $7}')
          if [ -z "$RUN_ID" ]; then
            echo "No run to cancel"
          else
            echo "Cancelling run $RUN_ID"
            gh run cancel $RUN_ID || true
          fi
