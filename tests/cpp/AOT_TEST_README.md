# AOT Unit Tests Programming Guide

An AOT test is usually composed of:
1. A python script that compiles the Kernels and serialize into file.
2. A C++ test that loads the file then perform execution.

AOT test writer will have to configure your test case in `cpptests.yaml`,
the format of which follows:

```yaml
- name: Descriptive name for the binary (not affecting actual test execution)
  binary: path/to/compiled/gtest_binary
  tests:
  - test: GTestModule.GTestCaseName
    prestart: path/to/python_scripts.py --arg1 --arg2
    marks: [mark1, mark2]
  - ...
```

`tests.marks` is used for test case selection (`-k` option of `run_tests.py`), and is optional.

For example:

```yaml
- name: C++ Tests
  binary: ../../build/taichi_cpp_tests
  tests:
  - test: LlvmAotTest.CpuKernel
    prestart: aot/python_scripts/kernel_aot_test1.py --arch=cpu
  - test: LlvmAotTest.CudaKernel
    prestart: aot/python_scripts/kernel_aot_test1.py --arch=cuda

- name: C-API Tests
  binary: ../../build/taichi_c_api_tests
  tests:
  - test: CapiTest.Float16Fill
    prestart: aot/python_scripts/numerical_aot_test_.py --arch=vulkan
    marks: [sm70]
```

The temporary directory where serialized cache file stays will be generated by test case runner. Both python program and C++ tests receives this directory path via environment variable `TAICHI_AOT_FOLDER_PATH`.

For each AOT test, runner will first run the python program specified by `tests.prestart`, followed by execution of the corresponding C++ test named by `tests.test`.
